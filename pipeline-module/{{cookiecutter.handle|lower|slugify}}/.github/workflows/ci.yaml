name: CI

"on": [push, pull_request]

jobs:
  tex:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 0 # full history for metadata
          submodules: true

      - name: Get SHA
        uses: benjlevesque/short-sha@v1.2
        id: short-sha

      - name: Login to GitHub Container Registry
        uses: docker/login-action@v1
        with:
          registry: ghcr.io
          username: token
          password: ${{'{{'}} secrets.GITHUB_TOKEN {{'}}'}}

      - name: TeX build
        run: |
          docker run -v `pwd`:/workspace -w /workspace ghcr.io/spherex/spherex-tex:latest sh -c 'make'

      - name: Upload PDF
        uses: actions/upload-artifact@v2
        with:
          name: {{ cookiecutter.handle }}-${{'{{'}} steps.short-sha.outputs.sha {{'}}'}}.pdf
          path: {{ cookiecutter.handle }}.pdf
          retention-days: 14
